<!--Copyright (c) 2015 Carlos Rafael Fernandes Picanço.-->
<!DOCTYPE html>
<html lang="{{ page.language }}">
{% if page.language == 'en' then %}
	{% capture SHARE_IMAGE %}{{ site.url }}/media/blog/in-flagellis-clean-en.png{% endcapture %}
{% elsif page.language == 'pt-BR' %}
	{% capture SHARE_IMAGE %}{{ site.url }}/media/blog/in-flagellis-clean-pt-br.png{% endcapture %}
{% endif %}
	{% include blog_head.html share-image=SHARE_IMAGE %}
	<body>
		<!-- Main Content -->
		<div class="container">
			<div class="row">
				<div class="infinite-container col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
			{% assign posts_count = site.posts | where: "language",page.language | size  %}
			{% assign OFFSET = site.mpaginate | times:page.index %}
			{% assign next_pag = page.index | plus:1 %}
			{% assign mod_pag = posts_count | modulo:site.mpaginate %}
			{% assign pages_count = posts_count | divided_by:site.mpaginate | plus:mod_pag %}

			{% if site.mpaginate < pages_count %}{% assign last_pag = pages_count | minus:1 %}
			{% else %}{% assign last_pag = pages_count %}{% endif%}

			{% if page.index == last_pag then %}{% assign next_pag = 'none' %}{% endif %}	

			Language={{ page.language }}, PostsCount={{ posts_count }}, OFFSET={{ OFFSET }}
			PagesCount={{ pages_count }}, NextPage={{ next_pag }}, LastPage={{ last_pag }}

			{% assign filtered_posts = site.container %}
			{% for post in site.posts %}
				{% if post.language == page.language then %}
					{% assign filtered_posts = filtered_posts | push: post %}
				{% endif %}
			{% endfor %}

			{% for post in filtered_posts limit:site.mpaginate offset:OFFSET %}
					<div class="infinite-item post-preview">
						<a href="{{ post.url }}">
							<h2 class="post-title">
								{{ post.title }}
							</h2>
							<h3 class="post-subtitle">
								{{ post.excerpt }}
							</h3>
						</a>

						{% if page.language == 'en' then %}
							<p class="post-meta">Posted by&#32;<a>{{ page.author }}</a>&#32;on&#32;{{ post.date | date: "%B %-d, %Y" }}.</p>
						{% elsif page.language == 'pt-BR' %}
							<p class="post-meta">Postado por&#32;<a>{{ page.author }}</a>,&#32;em&#32;{{ post.date | date: "%-d" }}
	                        &#32;de&#32;
	                        {% assign m = post.date | date: "%-m" %}
	                        {% case m %}
	                            {% when '1' %}Janeiro
	                            {% when '2' %}Fevereiro
	                            {% when '3' %}Março
	                            {% when '4' %}Abril
	                            {% when '5' %}Maio
	                            {% when '6' %}Junho
	                            {% when '7' %}Julho
	                            {% when '8' %}Agosto
	                            {% when '9' %}Setembro
	                            {% when '10' %}Outubro
	                            {% when '11' %}Novembro
	                            {% when '12' %}Dezembro
	                        {% endcase %}
	                        &#32;de&#32;
	                        {{ post.date | date: "%Y" }}.
							</p>
						{% endif %}
									
					<div class="row">
							<div class="col-lg-8 col-lg col-md-10">
								<ul class="list-inline">
					{% for tag in post.tags %}
									<li>
										<a href="tags/#{{ tag }}"><span class="badge">{{ tag }}</span></a>
									</li>
					{% endfor %}
								</ul>
							</div>
						</div>
					</div>
					<hr>
			{% endfor %}
				</div>
				<!-- Infinite More Link -->		
			{% if page.index == last_pag then %}
			{% else %}
				<a class="infinite-more-link" href="/blog/{{ page.language | downcase }}/page/{{ next_pag }}/">Next</a>
			{% endif %}	
			</div>
		</div>
		<hr>

		{% include global_scripts.html %}
		<!-- Infinite Scroll -->
		<script src="/js/jquery.waypoints.min.js"></script>
		<script src="/js/infinite.min.js"></script>

		<script type="text/javascript">
		    var infinite = new Waypoint.Infinite({
		      element: $('.infinite-container')[0]
		    })
		</script>

	</body>
</html>